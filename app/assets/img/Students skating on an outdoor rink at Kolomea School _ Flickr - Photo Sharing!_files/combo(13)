YUI.add("group-pool-by-tag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.Models["group-pool-models"],{name:this.name,attributes:{tagFilter:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:null}}})},"@VERSION@",{requires:["attribute-helpers"]});
YUI.add("flickr-groups-pools-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras(),per_page:t.perPage||20,page:t.page||1,get_group_info:1};if(t.id)n.group_id=e.Models["group-pool-models"].extractGroupFromCompoundId(t.id);else{if(!t.pathAlias)throw new Error("[flickr-groups-pools-getPhotos-fetcher] `id` or `pathAlias` is required.");n.group_path_alias=t.pathAlias}return t.withPhotoId&&(n.jump_to=t.withPhotoId),t.privacyFilter&&(n.privacy_filter=t.privacyFilter),t.safeSearch&&(n.safe_search=t.safeSearch),t.media&&(n.media=t.media),t.personFilter&&(n.user_id=t.personFilter),t.tagFilter&&(n.tags=t.tagFilter),n}function r(t,n){var r=t.apiResponse,i=t.photoModelRegistry,s=t.personModelRegistry,o=t.groupPoolModelRegistry,u=t.groupPoolByPersonModelRegistry,a=t.groupPoolByTagModelRegistry,f=t.photoEngagementModelRegistry,l=t.photoStatsModelRegistry,c=t.photoCurationModelRegistry,h=t.groupModelRegistry,p,d,v,m;return r.group.pathAlias=r.group.pathalias===""?null:r.group.pathalias,p=h.parseGroupModel(r.group.nsid,r.group.pathAlias,r.group),h.addOrUpdate(p),d={pathAlias:r.group.pathAlias,group:h.proxy(p.id),filteredPoolCount:r.group.poolCount},v=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:f,photoStatsModelRegistry:l,photoCurationModelRegistry:c}),d.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:v,totalItems:d.filteredPoolCount},n.personFilter?(d.id=e.Models["group-pool-models"].buildCompoundId(r.group.nsid,n.personFilter),d.personFilter=n.personFilter,d.filteredPoolCount=d.photoPageList.totalItems=r.photos.total,m=u):n.tagFilter?(d.id=e.Models["group-pool-models"].buildCompoundId(r.group.nsid,n.tagFilter),d.tagFilter=n.tagFilter,d.filteredPoolCount=d.photoPageList.totalItems=r.photos.total,m=a):(n.id&&n.id!==r.group.nsid?d.id=n.id:d.id=r.group.nsid,m=o),m.exists(d.id)?(m.setValue(d.id,"photoPageList",d.photoPageList),m.setValue(d.id,"group",d.group),m.setValue(d.id,"pathAlias",d.pathAlias),m.setValue(d.id,"filteredPoolCount",parseInt(d.filteredPoolCount,10)||0),d.group.setValue("poolCount",parseInt(r.group.poolCount,10)||0)):m.add(d),v}function i(n,r){var i=this,s=this._processParams(n),o={apiResponse:r.callAPI("flickr.groups.pools.getPhotos",s,!0),photoModelRegistry:r.getModelRegistry("photo-models"),personModelRegistry:r.getModelRegistry("person-models"),groupPoolModelRegistry:r.getModelRegistry("group-pool-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),photoCurationModelRegistry:r.getModelRegistry("photo-curation-models"),groupModelRegistry:r.getModelRegistry("group-models")};return n.personFilter&&(o.groupPoolByPersonModelRegistry=r.getModelRegistry("group-pool-by-person-models")),n.tagFilter&&(o.groupPoolByTagModelRegistry=r.getModelRegistry("group-pool-by-tag-models")),(new e.FlickrPromise(o)).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-pools-getPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photo-engagement-models","photo-stats-models","group-models","group-pool-models","group-pool-by-person-models","group-pool-by-tag-models","photo-curation-models"]});
YUI.add("group-contributor-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},dateJoined:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},groupDiscussionCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},groupPhotoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},rank:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoTitle:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},avatarUrl:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(e,t){return this.getValue(t,"latestPhotoId")?this.getValue(t,"contributorUrl")+this.getValue(t,"latestPhotoId")+"/":!1}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(e,t){return this.getValue(t,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(e,t){return"/photos/"+(this.getValue(t,"pathAlias")||this.getValue(t,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});
YUI.add("flickr-groups-getTopContributors-fetcher",function(e,t){"use strict";function n(e){var t={group_id:e.id,type:"all",extras:"include_viewer,is_pro"};return t}function r(e,t){var n=e[0],r=e[1],s=e[2],o,u,a;return u={photoContributors:[],discussionContributors:[],id:t.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(e){n.contributors[e.k]&&(o=n.contributors[e.k],o.contributor&&o.contributor.forEach(function(n){a=i(n,t.id),u[e.v].push(s.addOrUpdate(a))}))}),n&&n.viewer&&n.viewer.length!==0?(a=i(n.viewer,t.id),u.viewer=s.addOrUpdate(a)):u.viewer=null,r.addOrUpdate(u),r.proxy(u.id)}function i(t,n){var r={id:t.id+"-"+n,nsid:t.id,dateJoined:t.dateJoined?e.moment(t.dateJoined.toString(),"X"):e.moment(),groupDiscussionCount:t.groupDiscussionCount,groupPhotoCount:t.groupPhotoCount,pathAlias:t.pathAlias,rank:t.rank,realname:t.realname,username:t.username,isPro:t.isPro,avatarUrl:e.URLHelper.getBuddyIconURL(t.id,t.iconfarm,t.iconserver)};return t.latestPhoto&&(r.latestPhotoId=t.latestPhoto.id,r.latestPhotoTitle=t.latestPhoto.name),r}function s(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.getTopContributors",this._processParams(n),!0),r.getModelRegistry("group-top-contributors-models"),r.getModelRegistry("group-contributor-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:s,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});
YUI.add("group-top-contributors-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){var n=this;return e.ModelFetchers["flickr-groups-getTopContributors"].run(t,this.appContext).then(function(e){return n})}},attributes:{viewer:{isModel:!0,defaultValue:null},contributors:{isCollection:!0},photoContributors:{isCollection:!0},discussionContributors:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getTopContributors-fetcher","attribute-helpers"]});
YUI.add("group-pool-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-groups-pools-getPhotos"].run(t,this.appContext)},addPhoto:function(t,n){return t.registryName=this.name,e.ModelCreators["flickr-groups-pools-add"].run(t,n)},removePhoto:function(t,n){return t.registryName=this.name,e.ModelDeletors["flickr-groups-pools-remove"].run(t,n)},invitePhoto:function(t,n){return e.ModelCreators["flickr-groups-invite-photo-invite"].run(t,n)},cancelPhotoInvitation:function(t,n){return e.ModelDeletors["flickr-groups-invite-photo-cancel"].run(t,n)}},addPhotoLocal:function(e,t){return this.getValue(e,"photoPageList").unshift(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},addPhotoRemote:function(e,t){return this.remote.addPhoto.call(this,{photoID:t,groupID:e},this.appContext)},removePhotoLocal:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},removePhotoRemote:function(e,t){return this.remote.removePhoto.call(this,{photoID:t,groupID:e},this.appContext)},invitePhotoRemote:function(e,t){return this.remote.invitePhoto.call(this,{photoID:t,groupID:e},this.appContext)},cancelPhotoInvitationRemote:function(e,t){return this.remote.cancelPhotoInvitation.call(this,{photoID:t,groupID:e},this.appContext)},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultFn:function(e){return e}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return t||(t=e),"pool-"+t}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(e){return this.getValue(e,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(e,t){return e+"-"+t},extractGroupFromCompoundId:function(e){return e.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","attribute-helpers"],optional:["group-top-contributors-models"]});
YUI.add("flickr-groups-pools-getGroups-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.groups,a=n.id,f={},l=[];if(u)return u.group&&e.Array.each(u.group,function(e,t){var n,r,i;i=o.parseGroupModel(e.id,e.pathAlias,e),n=o.addOrUpdate(i),r=s.addOrUpdate({id:e.id,pathAlias:e.pathAlias,group:n}),l.push(r)}),f={id:a,memberCount:r.userGroupMemberships?r.userGroupMemberships.member:null,moderatorCount:r.userGroupMemberships?r.userGroupMemberships.moderator:null,adminCount:r.userGroupMemberships?r.userGroupMemberships.admin:null,invitedCount:r.userGroupMemberships?r.userGroupMemberships.invited:null},f.groups=e.APIHelper.response.addOrReplaceListByPage({current:i.exists(a)?i.proxy(a).getValue("groups").getList():[],perPage:n.perPage,pageNum:n.page,totalItems:r.groups.total,newPages:l}),i.exists(a)?i.setValue(a,"groups",f.groups):i.add(f),f.groups}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.pools.getGroups",{extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, needs_interstitial",page:n.page||0,per_page:n.perPage||400},!0),r.getModelRegistry("person-groups-models"),r.getModelRegistry("group-pool-models"),r.getModelRegistry("group-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-groups-pools-getGroups"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models","group-pool-models","person-models"]});
YUI.add("flickr-groups-fave-fetcher",function(e,t){"use strict";function n(e){}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.fave",n),r.getModelRegistry("person-groups-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-fave"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});
YUI.add("flickr-groups-unfave-fetcher",function(e,t){"use strict";function n(e){}function r(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.groups.unfave",n),r.getModelRegistry("person-groups-models")]).then(i._processResponse,e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-groups-unfave"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-groups-models","api-helper"]});
YUI.add("flickr-people-getGroupsWithStatus-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.groups,a=n.id,f,l={},c=[];if(u)return e.Array.each(u,function(t,r){var i,u,a,l=s.parseGroupModel(n.id,n.pathAlias,t);i=s.addOrUpdate(l),c.push(i),t.viewDates?(t.viewDates.pool!=="0"?u=e.moment(t.viewDates.pool,"X"):u=o.getDefaultViewedDate(),t.viewDates.discussions!=="0"?a=e.moment(t.viewDates.discussions,"X"):a=o.getDefaultViewedDate(),a.isValid()||(a=o.getDefaultViewedDate()),u.isValid()||(u=o.getDefaultViewedDate())):(u=o.getDefaultViewedDate(),a=o.getDefaultViewedDate()),f={id:l.id,viewedPool:u,viewedDiscussions:a,group:i},o.addOrUpdate(f)}),l={id:a,memberCount:r.members?r.members:null,moderatorCount:0,adminCount:0,invitedCount:0},l[n.attribute]=c,i.exists(a)?i.setValue(a,n.attribute,l[n.attribute]):i.add(l),l[n.attribute]}function r(n,r){var i=this,s={extras:e.APIHelper.request.getRebootGroupExtras()+", icon_urls, date_activity, date_last_viewed",user_id:n.id,status:n.status};return n.id!==r.getViewer().nsid&&(s.public_only=1,s.status="2,3,4"),e.Promise.all([r.callAPI("flickr.people.getGroupsWithStatus",s,!0),r.getModelRegistry("person-groups-models"),r.getModelRegistry("group-models"),r.getModelRegistry("group-activity-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-people-getGroupsWithStatus"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-groups-models","group-models"]});
YUI.add("person-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},faveGroup:function(t,n){return e.ModelFetchers["flickr-groups-fave"].run(t,n)},unfaveGroup:function(t,n){return e.ModelFetchers["flickr-groups-unfave"].run(t,n)}},faveGroup:function(e){var t=this,n=e.group_id,r=e.user_id;return this.remote.faveGroup(e,this.appContext).then(null,function(){t.appContext.getModel("group-models",n).then(function(e){t.getValue(r,"groupsFaved").removeFromList(n)})}),this.appContext.getModel("group-models",n).then(function(e){t.getValue(r,"groupsFaved").appendToList(e)})},unfaveGroup:function(e){var t=e.group_id,n=e.user_id,r=this;return this.remote.unfaveGroup(e,this.appContext).then(null,function(){r.appContext.getModel("group-models",t).then(function(e){r.getValue(n,"groupsFaved").appendToList(e)})}),this.appContext.getModel("group-models",t).then(function(e){r.getValue(n,"groupsFaved").removeFromList(t)})},attributes:{id:{},memberCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},moderatorCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},adminCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},invitedCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},groups:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-groups-pools-getGroups"]}},groupsAdministered:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsModerated:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsBelongingTo:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}},groupsFaved:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getGroupsWithStatus"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getGroups-fetcher","flickr-people-getInfo-fetcher","flickr-groups-fave-fetcher","flickr-groups-unfave-fetcher","flickr-people-getGroupsWithStatus-fetcher"]});
YUI.add("person-curation-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,n){var r={user_id:t};return"canPassOver"in n?e.ModelUpdaters["flickr-licensing-curation-passOverUser"].run(r,this.appContext):e.Promise.resolve()}},attributes:{enrollmentStatus:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},canPassOver:{validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-licensing-curation-passOverUser-updater","attribute-helpers"]});
YUI.add("flickr-photos-getContext-fetcher",function(e,t){"use strict";function n(t,n){var r;return r={photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},t.viewAs&&(r.view_as=t.viewAs),t.orderBy&&(r.order_by=t.orderBy),r}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h=c.getValue("owner"),p,d,v,m,g,y,b=[];return p=r.prevphotos,d=r.nextphotos,l=e.APIHelper.response.parsePhotos({photos:p.photo,existingPerson:h,photoModelRegistry:s,photoEngagementModelRegistry:o,photoStatsModelRegistry:u,photoCurationModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:d.photo,existingPerson:h,photoModelRegistry:s,photoEngagementModelRegistry:o,photoStatsModelRegistry:u,photoCurationModelRegistry:a}),m=i.getValue(n.id,"photoContextList"),g=m.hasMinBoundary?m.hasMinBoundary():!1,y=m.hasMaxBoundary?m.hasMaxBoundary():!1,v=m.getList(),b=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),hasMin:g,hasMax:y,current:v,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",b),{next:l,previous:f.reverse()}}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.getContext",this._processParams(n,r),!0),r.getModelRegistry("photostream-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-photos-getContext"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("flickr-people-getPhotos-fetcher",function(e,t){"use strict";function n(t){var n={per_page:t.perPage||20,page:t.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:t.withPhotoId||""};return t.id||t.userId?n.user_id=(t.id||t.userId).split("-")[0]:t.pathAlias&&(n.path_alias=t.pathAlias),t.privacyFilter&&(n.privacy_filter=t.privacyFilter),t.viewAs&&(n.view_as=t.viewAs),t.orderBy&&(t.orderBy==="datetaken"?n.sort="date-taken-desc":n.sort=t.orderBy),t.safeSearch&&(n.safe_search=t.safeSearch),t.media&&(n.media=t.media),t.withPhotoId&&(n.jump_to=t.withPhotoId),t.contentType&&(n.content_type=t.contentType),n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l,c,h=r&&r.user?r.user.nsid:null,p=n.id||n.userId;if(!h)throw new Error("API was missing valid nsid");return c={id:h,pathAlias:r.user.pathAlias,owner:e.APIHelper.response.parsePerson(r.user),totalItems:r.photos.total},p&&p!==h&&(c.id=p),t[7]&&(c.id=h+"-"+e.Models["person-preferences-models"].buildContextSuffix(t[7],h)),c.owner=s.addOrUpdate(c.owner),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,ownerID:r.photos.owner,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f}),c.photoPageList={perPage:r.photos.perpage,page:r.photos.page,pageContent:l,totalItems:parseInt(r.photos.total,10)||0},o.addOrUpdate(c),l}function i(n,r){var i=this,s=[r.callAPI("flickr.people.getPhotos",this._processParams(n),!0),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photostream-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")];return n.createCompoundID&&r.getViewer().signedIn&&r.getViewer().nsid&&s.push(r.getModel("person-preferences-models",r.getViewer().nsid)),e.Promise.all(s).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("photostream-models",function(e,t){function n(e){n.superclass.constructor.call(this,e)}e.Models[this.name]=n,e.extend(n,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.appContext.getViewer(),n=this.getValue(e,"normalizedId"),r;return t&&t.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(r=this.getValue(e,"owner"),r?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:r.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"}))}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=this.getValue(e,"normalizedId"),r=t?t.getValue("pathAlias"):n;return"/photos/"+r+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,r=n.splitCompoundId(e);return r.orderBy?(t=r.orderBy,r.viewAs?t+="-"+r.viewAs:r.orderBy==="dateposted"&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,n){var r=e;return t&&(r+="-"+t),n&&(t||(r+="-dateposted"),r+="-"+n),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});
YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return"/photos/"+t+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});
YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var n=this.getValue(t,"isPro"),r=this.getValue(t,"isAdFree");return n||r}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},curation:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper","person-curation-models"]});
YUI.add("flickr-people-getInfo-fetcher",function(e,t){"use strict";function n(t,n){var r={datecreate:1};r.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&t.id===n.request.probableUser&&(r.storage=1,r.extras+=", classic_user_id, active_group_membership, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref",n.flipper.isFlipped("enable-new-pro")&&(r.extras+=", products_features"),r.extras+=", is_minor"),t.extras&&typeof t.extras=="string"&&t.extras.length>0&&(r.extras=r.extras+","+t.extras);if(t.id)r.user_id=t.id;else{if(!t.pathAlias)throw new Error("`fetch` is missing required params.");r.path_alias=t.pathAlias}return t.storage&&(r.storage=t.storage),r.extras||(r.extras=""),r.extras+=", has_stats",r}function r(t,n,r){var i=t.apiResponse,s=t.personModelRegistry,o=t.personRelationshipModelRegistry,u=t.personProfileModelRegistry,a=t.personPreferencesModelRegistry,f=t.personGroupsModelRegistry,l=t.personNotificationsModelRegistry,c=t.personCurationModelRegistry,h=t.photostreamModelRegistry,p,d=i.person,v,m=r.getViewer(),g=d.id,y;return y={id:g,pathAlias:d.pathAlias,username:d.username&&d.username._content,realname:d.realname&&d.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.iconurls),isAdFree:d.isAdFree,isPro:d.ispro,isMinor:d.isMinor,canBuyPro:d.canBuyPro,hasStats:d.hasStats,location:d.location&&d.location._content,hasAdfree:d.hasAdfree,has1TB:d.has1TB,has2TB:d.has2TB,hasUnlimitedStorage:d.hasUnlimitedStorage,hasFreeStandardShipping:d.hasFreeStandardShipping,hasFreeEducationalResources:d.hasFreeEducationalResources,dateCreated:d.datecreate._content},d.ispro&&(y.proExpireDate=d.expire),s.addOrUpdate(y),l.addOrUpdate({id:g,unreadNotificationCount:0,unreadFlickrMailCount:0}),o.addOrUpdate({id:g,pathAlias:d.pathAlias,isContact:d.contact,isFriend:d.friend,isFamily:d.family,isIgnored:d.ignored,isIgnoredBy:d.ignoredby}),m&&m.signedIn&&g===m.nsid&&(v={id:g},d.safeSearch&&(v.safeSearch=(d.safeSearch||1)-1),d.viewPrefs&&(v.unifiedSearchViewPref=d.viewPrefs.unifiedSearchViewPref,v.photostreamViewOrderPref=d.viewPrefs.photostreamViewOrderPref,v.photostreamViewAsPref=d.viewPrefs.photostreamViewAsPref,v.albumViewLayoutPref=d.viewPrefs.albumViewLayout),a.exists(g)?a.setValues(g,v):a.add(v)),p={id:g,coverPhotoUrls:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(d.coverphoto_url),photoCount:d.photos.count.content,location:d.location?d.location.content:null},d.storage&&(p.storageUsed=d.storage.used.content,p.storageTotal=d.storage.total.content),d.unreadMessages&&(p.unreadMessages=d.unreadMessages.content),u.addOrUpdate(p),f.addOrUpdate({id:g,memberCount:d.groupMemberships?d.groupMemberships.member:null,moderatorCount:d.groupMemberships?d.groupMemberships.moderator:null,adminCount:d.groupMemberships?d.groupMemberships.admin:null,invitedCount:d.groupMemberships?d.groupMemberships.invited:null}),c.addOrUpdate({id:g,enrollmentStatus:d.curation&&d.curation.status_name||"",canPassOver:d.curation&&d.curation.can_pass_over||!1}),h.addOrUpdate({id:g,pathAlias:d.pathAlias,owner:s.proxy(g),totalItems:d.photos.count&&d.photos.count.content}),d}function i(n,r){var i=this,s=r.getViewer(),o=!0;return s&&s.signedIn&&(n.id===s.nsid||n.nsid===s.nsid)&&(n.storage=1),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.people.getInfo",this._processParams(n,r),o),personModelRegistry:r.getModelRegistry("person-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),personProfileModelRegistry:r.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:r.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:r.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:r.getModelRegistry("person-notifications-models"),personCurationModelRegistry:r.getModelRegistry("person-curation-models"),photostreamModelRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","person-curation-models","photostream-models","api-helper"]});
YUI.add("person-relationship-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[],i={};if(e.Lang.isObject(n,!0)){i.user_id=t,i.friend=this.getValue(t,"isFriend"),i.family=this.getValue(t,"isFamily"),"isContact"in n&&(n.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(i,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(i,this.appContext)));if("isFriend"in n||"isFamily"in n)"isFriend"in n&&(i.friend=n.isFriend.newVal),"isFamily"in n&&(i.family=n.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(i,this.appContext));"isIgnored"in n&&(n.isIgnored.newVal===!0?r.push(e.ModelUpdaters["flickr-contacts-block"].run(i,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(i,this.appContext)))}return e.Promise.all(r)}},toggleFollowing:function(e){var t=this.getValue(e,"isContact");t?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){var t=this.getValue(e,"isFriend");t?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){var t=this.getValue(e,"isFamily");t?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){var t=this.getValue(e,"isIgnored");t?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var n=this.appContext.getViewer();return!!n&&this.getValue(t,"nsid")===n.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});
YUI.add("follow-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("isActiveViewAgnostic",e.isActiveViewAgnostic),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.realFullscreen=!!e.realFullscreen,this.isFluid=e.isFluid,this.isOnDark=e.isOnDark,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.isOnMobile=e.isOnMobile,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.set("relationship",t),e.nsid=e.nsid||t.id})},buildContainer:function(){var e=this.get("relationship"),t;return t=this.templates("follow")({showNoButton:e.getValue("isMe")||e.getValue("isIgnoredBy"),showUnblockButton:e.getValue("isIgnored"),showFollowingButton:e.getValue("isContact"),signedIn:this.appContext.getViewer().signedIn,isFluid:this.isFluid,isOnMobile:this.isOnMobile,isOnDark:this.isOnDark,followIntlKey:"common.FOLLOW",followingIntlKey:"common.FOLLOWING"}),this.setContainerHTML(t),this},activate:function(){var t=this,r=this.get("container"),i=this.get("relationship"),s,o;return this.isFluid&&!i.getValue("isMe")?this.registerEventHandler(r.delegate("click",function(r){e.rapidTracker.beacon(this.name,"followButtonClick"),s=r.target.hasClass("follow")?r.target:r.target.ancestor(".follow"),t.appContext.getViewer().signedIn?i.getValue("isIgnored")?(i.registry.toggleIgnore(t.nsid),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls(),i.registry.remoteUpdate(t.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){i.setValue("isIgnored",!0),t.buildContainer(),n.error({err:e})})):i.getValue("isContact")?(s.addClass("is-open"),o&&o.destroy(),o=new e.Views.FluidDroparound({appContext:t.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:140,height:130,observePageResize:!0,anchorOffsetHorizontal:2,anchorElement:s.one(".drop-icon"),subview:new e.Views["relationship-menu-view"]({nsid:t.nsid,pathAlias:t.pathAlias,disableRefreshOnRelationshipChange:t.disableRefreshOnRelationshipChange}),preferLeft:!0}),o.on("closeDroparound",function(){s.removeClass("is-open"),t.fire("subviewViewEvent","isClosed")}),o.show(),t.fire("subviewViewEvent","isOpen"),o.get("subview").on("onUnfollow",function(){o.close(),o.destroy(),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls()})):t.followPerson():t.signInAndRedirectToPerson()},"button.follow")):(r&&r.one("button")&&this.registerEventHandler(r.one("button").on("click",t.handleRelationshipClick,t)),this.get("relationship").getValue("isMe")||this.setupDropdown()),t},followPerson:function(){var t=this,r=this.get("relationship");r.getValue("isContact")||(r.registry.toggleFollowing(this.nsid),t.disableRefreshOnRelationshipChange?this.buildContainer():this.showBalls(),r.registry.remoteUpdate(this.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){t.hideBalls(),r.setValue("isContact",!1),t.buildContainer(),n.error({err:e})}))},showBalls:function(){this.balls||(this.balls=e.Node.create(this.templates("flickr-balls")({}))),this.get("container").append(this.balls),this.balls.show(),this.get("container").one(".follow").hide()},hideBalls:function(){this.balls&&(this.balls.remove(),this.get("container").one(".follow").show())},handleRelationshipClick:function(t){var n=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"followButtonClick");var r=this.get("relationship").getValue("isContact");this.appContext.getViewer().signedIn?r===!1?(this.followPerson(),e.rapidTracker.beacon(this.name,"photoAttributionFollowButtonClick")):n.isOnMobile?n.handleUnfollowClick(t):(n.relationshipDropDownDialog.toggle(),e.rapidTracker.beacon(this.name,"photoAttributionFollowMenuClick")):n.isOnMobile?e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:n.appContext.getUA().os,isWebview:n.appContext.getUA().isWebview,pageURL:"/photos/"+n.nsid,beacon:{name:"mpp_follow_signedout",section:"attribution-view"},viewName:n.name})}):n.signInAndRedirectToPerson()},handleFriendChange:function(t){var r=this;this.get("relationship").registry.toggleFriend(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFriend(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleFamilyChange:function(t){var r=this;this.get("relationship").registry.toggleFamily(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").registry.toggleFamily(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),n.error({err:e})}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleUnfollowClick:function(t){var r=this;t.preventDefault(),this.get("relationship").registry.toggleFollowing(this.nsid),r.disableRefreshOnRelationshipChange||this.showBalls(),this.isOnMobile||this.relationshipDropDownDialog.toggle(function(){this.toggleFollowingButton
(t.target.ancestor(".relationship").one("button"),this.get("relationship").getValue("isContact"))}.bind(this)),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){r.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(e){this.hideBalls(),this.get("relationship").setValue("isContact",!0),this.toggleFollowingButton(t.target.ancestor("button"),!0),n.error({err:e})}.bind(this)),e.rapidTracker.beacon(this.name,"photoAttributionUnfollowButtonClick")},toggleFollowingButton:function(e,t){t?(e.setContent("<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>"),e.addClass("follow-anim").addClass("is-following"),setTimeout(function(){e.removeClass("follow-anim")},500),e.addClass("ui-button-dropdown")):(e.addClass("unfollow-anim").removeClass("is-following"),setTimeout(function(){e.removeClass("unfollow-anim")},500),e.one("span").setContent(this.intlMessage({intlName:"common.FOLLOW"})),e.removeClass("ui-button-dropdown"))},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1});n.show()},setupDropdown:function(){var t=this,n=t.get("container"),r,i=n.one(".relationship"),s,o=n.one(".relationship button");if(!i)return;s=this.templates("following-dropdown")({isFriend:this.get("relationship").getValue("isFriend"),isFamily:this.get("relationship").getValue("isFamily")}),this.relationshipDropDownDialog=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".relationship"),positioning:!1,parent:this}),this.registerEventHandler(this.relationshipDropDownDialog.on("hide",function(e){o.removeClass("is-open")})),this.registerEventHandler(this.relationshipDropDownDialog.on("show",function(e){o.addClass("is-open")})),this.relationshipDropDownDialog.render(),r=this.relationshipDropDownDialog.get("container"),r.detach("click"),this.registerEventHandler(r.one(".following-unfollow").on("click",this.handleUnfollowClick,this)),this.registerEventHandler(r.one(".following-friend input").on("change",this.handleFriendChange,this)),this.registerEventHandler(r.one(".following-family input").on("change",this.handleFamilyChange,this))},showSignUpModal:function(){var t=this;this.appContext.getModel("person-models",this.nsid).then(function(n){var r=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,i=t.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:n.getValue("displayname")}),s=n.getValue("buddyicon"),o;s.displayUrl=s.retina||s.large||s.medium||s.default,o=new e.Views.SignUpModal({appContext:t.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:s.displayUrl,signUpTitle:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:i,beaconPrefix:"follow"}),o.on("signUpClick",function(n){e.SigninHelper.signUpPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.on("signInClick",function(n){e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.show()})},signInAndRedirectToPerson:function(){var t=this,n=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,r=t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_MESSAGE"}),i=t.intlMessage({intlName:"person.SIGN_IN_AND_FOLLOW"}),s=t.intlMessage({intlName:"common.CANCEL"}),o;if(this.signedOutTest)return this.showSignUpModal();o=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),htmlMessage:r,actionButtonLabel:i,cancelButtonLabel:s}),o.on("actionClick",function(){e.rapidTracker.beacon(t.name,"followModalSigninClick"),e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:n})}),o.on("cancelClick",function(n){e.rapidTracker.beacon(t.name,"followModalCancelClick")}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-follow","follow-css","promise","fluid-droparound-view","fluid-modal-view","signup-modal-view","dialog","hermes-template-following-dropdown","hermes-template-flickr-balls","fluid-balls-css","relationship-menu-view","signin-helper"],optional:["person-models","person-relationship-models"],langBundles:["common","person"]});
YUI.add("hermes-template-fluid-avatar-editor",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="avatar-editor-container" style="height:',(o=n.contentHeight)?o=o.call(t,{hash:{},data:i}):(o=t.contentHeight,o=typeof o===u?o.apply(t):o),s+=a(o)+'px">\n	<div class="avatar-clip">\n		<div class="avatar-image"></div>\n	</div>\n\n	<div class="controls-area">\n		<div class="zoom-controls">\n			<p class="zoom-minus"></p>\n			<p class="zoom-plus"></p>\n\n			<div class="zoom-handle"></div>\n\n			<div class="zoom-guide"><span class="low-quality-zone"></span></div>\n		</div>\n	</div>\n\n	<div class="avatar-background">\n	</div>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fluid-avatar-editor",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fluid-avatar-editor-view",function(e){"use strict";var t={dragging:{mouseDownX:0,mouseDownY:0,previousX:0,previousY:0,centerX:0,centerY:0,startDrag:!1,overlayDiameter:0},zoom:{scale:1,scaleFactor:1,mouseDownX:0,previousX:0,startDrag:!1,midpoint:0,height:0,width:0,max:0,min:0,isLowQuality:!1},potential:{height:0,width:0,url:"",x:0,y:0},original:{x:0,y:0}},n=10,r=.25;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("photoModel",e.photoModel),this.contentHeight=e.contentHeight,t.zoom.scale=1,t.dragging.startDrag=!1,t.zoom.startDrag=!1,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return this.setContainerHTML(this.templates("fluid-avatar-editor")({contentHeight:this.contentHeight})),this},activate:function(){return this.avatarBackground=this.get("container").one(".avatar-background"),this.avatarFocus=this.get("container").one(".avatar-image"),this.zoomHandle=this.get("container").one(".zoom-handle"),this.containerWidth=this.get("container").get("offsetWidth"),this.containerHeight=this.get("container").get("offsetHeight"),this.loadAvatarPhoto(),this},showTooltip:function(){this.zoomTooltip||(this.zoomTooltip=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showDropArrow:!0,width:150,anchorElement:this.zoomHandle,textMessage:this.intlMessage({intlName:"header.MIN_ZOOM"}),invisibleOverlay:!0,anchorOffsetHorizontal:11,classList:"over-modal",overlayClassList:"over-modal"})),this.zoomTooltip.show()},hideTooltip:function(){this.zoomTooltip&&!this.zoomTooltip.isClosed&&this.zoomTooltip.close()},loadAvatarPhoto:function(){var e=new Image,n;e.onload=this.handleImageLoad.bind(this),n=this.get("photoModel").getLargestSize(),t.potential.width=n.width,t.potential.height=n.height,t.potential.url=n.url,t.zoom.width=n.width*t.zoom.scale,t.zoom.height=n.height*t.zoom.scale,e.src=n.url,(e.complete||e.onloadFired)&&this.handleImageLoad()},handleImageLoad:function(){var e=this.get("container"),n=e.one(".avatar-clip");t.dragging.centerX=(t.potential.width/2-this.containerWidth/2)*-1,t.dragging.centerY=(t.potential.height/2-this.containerHeight/2)*-1,t.dragging.overlayDiameter=parseInt(n.getStyle("width"),10)/2,this.offsetLeft=this.containerWidth/2-t.dragging.overlayDiameter,this.offsetTop=this.containerHeight/2-t.dragging.overlayDiameter,t.potential.x=t.dragging.centerX,t.potential.y=t.dragging.centerY,t.original.x=t.dragging.centerX,t.original.y=t.dragging.centerY,this.saveParamsForAPI(),e.one(".avatar-image").setStyles({backgroundImage:"url("+t.potential.url+")",width:t.potential.width+"px",height:t.potential.height+"px",left:t.dragging.centerX+this.offsetLeft*-1+"px",top:t.dragging.centerY+this.offsetTop*-1+"px"}),e.one(".avatar-background").setStyles({backgroundImage:"url("+t.potential.url+")",width:t.potential.width+"px",height:t.potential.height+"px",left:t.dragging.centerX+"px",top:t.dragging.centerY+"px"}),this.setupEventListeners(),this.setupZoomHandler()},setupEventListeners:function(){var n=this.get("container"),r=n.one(".avatar-background"),i=n.one(".avatar-image"),s=n.one(".controls-area"),o=this;this.registerEventHandler(r.on("mousedown",function(e){e.halt(),t.dragging.mouseDownY=e.pageY,t.dragging.mouseDownX=e.pageX,t.dragging.previousY=parseInt(r.getStyle("top"),10),t.dragging.previousX=parseInt(r.getStyle("left"),10),t.dragging.startDrag=!0,r.addClass("grabbing"),s.addClass("clickthrough")})),this.registerEventHandler(r.on("mousemove",function(e){e.halt();if(!t.dragging.startDrag)return;var n=t.dragging.mouseDownY-e.pageY,s=t.dragging.mouseDownX-e.pageX,u=t.dragging.previousY-n,a=t.dragging.previousX-s,f=o.snapFocusToFit(a,u);a=f.x,u=f.y,t.potential.x=a,t.potential.y=u,t.original.x=(o.containerWidth-o.containerWidth/t.zoom.scale)/2+t.potential.x/t.zoom.scale,t.original.y=(o.containerHeight-o.containerHeight/t.zoom.scale)/2+t.potential.y/t.zoom.scale,o.saveParamsForAPI(),r.setStyle("left",a),r.setStyle("top",u),i.setStyle("left",a+o.offsetLeft*-1),i.setStyle("top",u+o.offsetTop*-1)})),this.registerEventHandler(e.one("body").on("mouseup",function(){t.dragging.startDrag=!1,r.removeClass("grabbing"),s.removeClass("clickthrough")})),this.registerEventHandler(r.on("mouseup",function(){t.dragging.startDrag=!1,r.removeClass("grabbing"),s.removeClass("clickthrough")}))},determineBoundaries:function(){return{minX:t.dragging.centerX+t.zoom.width/2-t.dragging.overlayDiameter,minY:t.dragging.centerY+t.zoom.height/2-t.dragging.overlayDiameter,maxX:t.dragging.centerX-t.zoom.width/2+t.dragging.overlayDiameter,maxY:t.dragging.centerY-t.zoom.height/2+t.dragging.overlayDiameter}},snapFocusToFit:function(e,t){var n=this.determineBoundaries();return e=e<=n.minX?e:n.minX,e=e>=n.maxX?e:n.maxX,t=t<=n.minY?t:n.minY,t=t>=n.maxY?t:n.maxY,{x:e,y:t}},setupZoomHandler:function(){var n=this,i=this.get("container"),s=i.one(".controls-area"),o=i.one(".zoom-controls"),u=i.one(".zoom-plus"),a=i.one(".zoom-minus"),f;t.zoom.max=parseInt(o.get("offsetWidth"),10)-parseInt(this.zoomHandle.get("offsetWidth"),10),t.zoom.previousX=parseInt(this.zoomHandle.getStyle("left"),10),t.zoom.scaleFactor=1/(t.zoom.max/4),t.zoom.midpoint=t.zoom.max/2,f=Math.max(t.dragging.overlayDiameter*2/t.potential.width,t.dragging.overlayDiameter*2/t.potential.height),t.zoom.min=(f-r)*2/t.zoom.scaleFactor,t.zoom.min>t.zoom.max&&(t.zoom.isLowQuality=!0,this.zoomHandle.setStyle("left",t.zoom.max)),i.one(".low-quality-zone").setStyle("width",Math.min(t.zoom.min,t.zoom.max)),t.zoom.scale=Math.max(t.zoom.min,t.zoom.midpoint)*t.zoom.scaleFactor/2+r,this.updateImageScale(),this.registerEventHandler(this.zoomHandle.on("mousedown",this.onZoomBarClicked.bind(this))),this.registerEventHandler(s.on("mousemove",this.onZoomBarMoved.bind(this))),this.registerEventHandler(u.on("click",this.zoomByIncrement.bind(this))),this.registerEventHandler(a.on("click",this.zoomByIncrement.bind(this))),this.registerEventHandler
(i.on("mouseup",function(e){e.halt(),t.zoom.startDrag=!1,n.zoomHandle.removeClass("dragging")})),this.registerEventHandler(e.one("body").on("mouseup",function(e){e.halt(),t.zoom.startDrag=!1,n.zoomHandle.removeClass("dragging")}))},onZoomBarClicked:function(e){e.halt(),t.zoom.mouseDownX=e.pageX,t.zoom.startDrag=!0,t.zoom.previousX=parseInt(this.zoomHandle.getStyle("left"),10),this.zoomHandle.addClass("dragging")},onZoomBarMoved:function(e){e.halt();if(!t.zoom.startDrag)return;var n=t.zoom.mouseDownX-e.pageX,i=t.zoom.previousX-n;i=i<=t.zoom.min?t.zoom.min:i,i=i>=t.zoom.max?t.zoom.max:i,t.zoom.scale=i*t.zoom.scaleFactor/2+r;if(i<=t.zoom.min&&t.zoom.isLowQuality){this.showTooltip();return}i===t.zoom.min?this.showTooltip():this.hideTooltip(),this.zoomHandle.setStyle("left",i),this.updateImageScale()},zoomByIncrement:function(e){var i,s=parseInt(this.zoomHandle.getStyle("left"));if(!e)return;e.halt(),e.target.hasClass("zoom-plus")?i=s+parseInt(t.zoom.max/n):e.target.hasClass("zoom-minus")&&(i=s-parseInt(t.zoom.max/n)),i=i<=t.zoom.min?t.zoom.min:i,i=i>=t.zoom.max?t.zoom.max:i;if(i<=t.zoom.min&&t.zoom.isLowQuality){this.showTooltip();return}i===t.zoom.min?this.showTooltip():this.hideTooltip(),t.zoom.previousX=i,t.zoom.scale=i*t.zoom.scaleFactor/2+r,this.zoomHandle.setStyle("left",i),this.updateImageScale()},updateImageScale:function(){var e,n,r;t.zoom.width=t.potential.width*t.zoom.scale,t.zoom.height=t.potential.height*t.zoom.scale,t.dragging.centerX=(t.zoom.width/2-this.containerWidth/2)*-1,t.dragging.centerY=(t.zoom.height/2-this.containerHeight/2)*-1,e=(this.containerWidth-this.containerWidth*t.zoom.scale)/2+t.original.x*t.zoom.scale,n=(this.containerHeight-this.containerHeight*t.zoom.scale)/2+t.original.y*t.zoom.scale,r=this.snapFocusToFit(e,n),e=r.x,n=r.y,t.potential.x=e,t.potential.y=n,this.saveParamsForAPI(),this.avatarBackground.setStyles({width:t.zoom.width+"px",height:t.zoom.height+"px",left:e+"px",top:n+"px"}),this.avatarFocus.setStyles({width:t.zoom.width+"px",height:t.zoom.height+"px",left:e+this.offsetLeft*-1+"px",top:n+this.offsetTop*-1+"px"})},saveParamsForAPI:function(){var n=t.zoom.width/2-(t.potential.x-t.dragging.centerX),r=t.zoom.height/2-(t.potential.y-t.dragging.centerY);n/=t.zoom.scale,r/=t.zoom.scale,this.set("apiParams",{x1:parseInt(n-t.dragging.overlayDiameter/t.zoom.scale),x2:parseInt(n+t.dragging.overlayDiameter/t.zoom.scale),y1:parseInt(r-t.dragging.overlayDiameter/t.zoom.scale),y2:parseInt(r+t.dragging.overlayDiameter/t.zoom.scale),url:e.URLHelper.addProtocolToURL(t.potential.url)})},destructor:function(){return this.hideTooltip(),this.constructor.superclass.destroy.call(this)}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-css","hermes-template-fluid-avatar-editor","fluid-avatar-editor-css","url-helper","fluid-droparound-view"],langBundles:["header"]});
YUI.add("hermes-lang-header",function(e,t){e.Intl.add("hermes/header","en-US",{EDIT_COVER_PHOTO:["Edit cover photo"],PHOTOSTREAM:["Photostream"],ALBUMS:["Albums"],FAVORITES:["Favorites"],CREATIONS:["Creations"],PHOTO_BOOKS:["Photo Books"],EDIT:["Edit"],PUBLIC:["Public"],ALL:["All"],CHANGE_YOUR_BUDDY_ICON:["Change your Buddy Icon"],CHANGE_YOUR_GROUP_ICON:["Change your group icon"],MEMBER_SINCE:["Member Since"],GROUP_SINCE:["Group Since"],MDY_DATE:[{type:"date",valueName:"mdyDate",format:"medium"}],PHOTOS:["Photos"],VIEWS:["Views"],VIEW_ALL_ALBUMS:["View all albums"],SEND_FLICKR_MAIL:["Send FlickrMail"],BLOCK:["Block"],USERS_GOD_PAGE:["User's God Page"],GROUP_GOD_PAGE:["God"],ADMINISTRATION:["Administration"],DISCUSSIONS:["Discussions"],MEMBERS:["Members"],MAP:["Map"],ABOUT:["About"],INVITE:["Invite Friends"],OVERVIEW:["Overview"],FULLSCREEN:["Fullscreen"],SHARE_THIS_PAGE:["Share this page"],COMMENT:["Comment"],MORE_ACTIONS:["More actions"],THUMBNAIL_VIEW:["Thumbnail view"],GROUP_LIST:["Group List"],CREATE_GROUP:["Create Group"],COVER_PHOTO_CHOOSE:["Choose Cover Photo"],COVER_PHOTO_UPLOAD:["Upload a photo"],COVER_PHOTO_SET_POSITION:["Drag to set position!"],COVER_PHOTO_SAVE:["Save"],COVER_PHOTO_CANCEL:["Cancel"],COVER_PHOTO_LIST_ERROR:["We're having some trouble listing your photos. Try again in a few seconds."],COVER_PHOTO_SELECT_ERROR:["We're having some trouble selecting that photo. Try again in a few seconds."],COVER_PHOTO_POSITION_ERROR:["We're having some trouble positioning that photo. Try again in a few seconds."],COVER_PHOTO_LOW_RESOLUTION:["This photo is small and may not look great as a coverphoto."],COVER_PHOTO_NO_PHOTOS:["Uh oh! No photos here.<br/>What? Do we have to take them for you, too?"],GROUPS_HEADER:["Your Groups"],GROUP_JOIN:["Join Group"],GROUP_JOINED:["Joined"],GROUP_JOIN_REQUESTED:["Join Requested"],GROUP_LEAVE_GROUP:["Leave Group"],GROUPS_OPT_OUT_MESSAGE:["You are viewing the beta version of our new groups experience. Click here to return to the old version."],GROUPS_OPT_IN_MESSAGE:["Go back to the beta groups experience."],STEAMPUNK_OCTOPUS:["Steampunk Octopus"],FOLLOWERS:[{type:"plural",valueName:"count",options:{one:"${#} Follower",other:"${#} Followers"}}],FOLLOWING:[{type:"plural",valueName:"count",options:{one:"${#} Following",other:"${#} Following"}}],FOLLOWERS_SIMPLE:["Followers"],FOLLOWING_SIMPLE:["Following"],JOINED_YEAR:["Joined ","${year}"],COUNT_PHOTOS:[{type:"plural",valueName:"count",options:{one:"${#} Photo",other:"${#} Photos"}}],GUESTPASS_HISTORY:["Sharing history"],POSITION_IMAGE:["Position your image"],MIN_ZOOM:["You can't zoom out anymore for this image"]})},"@VERSION@",{requires:["intl"]});
