YUI.add("hermes-template-photo-list-photo-interaction",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i;r+='\n		<div class="extra-tools">\n			',i=n["if"].call(e,e.removeToolClass,{hash:{},inverse:c.noop,fn:c.program(2,p,t),data:t});if(i||i===0)r+=i;r+="\n			",i=n["if"].call(e,e.bigScotchTitle,{hash:{},inverse:c.noop,fn:c.program(4,d,t),data:t});if(i||i===0)r+=i;r+="\n			",i=n["if"].call(e,e.moreMenuItems,{hash:{},inverse:c.noop,fn:c.program(6,v,t),data:t});if(i||i===0)r+=i;return r+="\n		</div>\n	",r}function p(e,t){var r="",i;return r+='\n				<div class="extra-tool remove-photo ',(i=n.removeToolClass)?i=i.call(e,{hash:{},data:t}):(i=e.removeToolClass,i=typeof i===a?i.apply(e):i),r+=f(i)+'" data-id='+f((i=(i=e.photo,i==null||i===!1?i:i.id),typeof i===a?i.apply(e):i))+"></div>\n			",r}function d(e,t){var r="",i,s;return r+='\n				<div class="extra-tool big-scotch" data-id='+f((i=(i=e.photo,i==null||i===!1?i:i.id),typeof i===a?i.apply(e):i))+' title="',(s=n.bigScotchTitle)?s=s.call(e,{hash:{},data:t}):(s=e.bigScotchTitle,s=typeof s===a?s.apply(e):s),r+=f(s)+'"></div>\n			',r}function v(e,t){var r="",i,s;return r+='\n				<div class="extra-tool more-menu" data-menu-items="',(i=n.moreMenuItems)?i=i.call(e,{hash:{},data:t}):(i=e.moreMenuItems,i=typeof i===a?i.apply(e):i),r+=f(i)+'" data-id='+f((i=(i=e.photo,i==null||i===!1?i:i.id),typeof i===a?i.apply(e):i))+' title="',s={hash:{intlName:"common.MORE"},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):l.call(e,"intlMessage",s)))+'"></div>\n			',r}function m(e,t){var r="",i;r+='\n		<div class="curator-tools">\n			',i=n.each.call(e,e.curatorTools,{hash:{},inverse:c.noop,fn:c.program(9,g,t),data:t});if(i||i===0)r+=i;return r+="\n			</ul>\n		</div>\n	",r}function g(e,t){var n="",r;return n+='\n				<li>\n					<i class="ui-icon-curator-'+f((r=e.name,typeof r===a?r.apply(e):r))+'"></i>\n				</li>\n			',n}function y(e,t){var r="",i,s,o;r+='\n		<div class="marketplace-licensable">\n			<a data-photoid="'+f((i=(i=e.photo,i==null||i===!1?i:i.id),typeof i===a?i.apply(e):i))+'" data-ownerid="'+f((i=(i=(i=e.photo,i==null||i===!1?i:i.owner),i==null||i===!1?i:i.id),typeof i===a?i.apply(e):i))+'" data-track="photoListLicenseButtonClick" target="_blank" href="'+f((i=(i=e.photo,i==null||i===!1?i:i.marketplaceLicensingUrl),typeof i===a?i.apply(e):i))+'" class="tiny butt photoListLicenseButton">',o={hash:{},inverse:c.program(14,w,t),fn:c.program(12,b,t),data:t},s=(i=n.isFlipped||e.isFlipped,i?i.call(e,e.flippers,"buy-button-in-photolist",o):l.call(e,"isFlipped",e.flippers,"buy-button-in-photolist",o));if(s||s===0)r+=s;return r+="</a>\n		</div>\n	",r}function b(e,t){var r,i;return i={hash:{intlName:"common.BUY"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):l.call(e,"intlMessage",i)))}function w(e,t){var r,i;return i={hash:{intlName:"common.BUY_LICENSE"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):l.call(e,"intlMessage",i)))}function E(e,t){var n;return f((n=(n=e.photo,n==null||n===!1?n:n.title),typeof n===a?n.apply(e):n))}function S(e,t){var r,i;return i={hash:{intlName:"common.UNTITLED"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):l.call(e,"intlMessage",i)))}function x(e,t){var r="",i,s;return r+=" ",s={hash:{intlName:"common.BY_YOU"},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):l.call(e,"intlMessage",s))),r}function T(e,t){var r="",i,s;return r+=" ",s={hash:{intlName:"common.BY_USER",user:(i=(i=e.photo,i==null||i===!1?i:i.owner),i==null||i===!1?i:i.username)},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):l.call(e,"intlMessage",s))),r}function N(e,t){var r="",i,s;r+="\n				",s=n["if"].call(e,(i=e.photo,i==null||i===!1?i:i.title),{hash:{},inverse:c.program(27,k,t),fn:c.program(25,C,t),data:t});if(s||s===0)r+=s;r+="\n				",s=n["if"].call(e,(i=(i=e.photo,i==null||i===!1?i:i.owner),i==null||i===!1?i:i.displayname),{hash:{},inverse:c.program(35,_,t),fn:c.program(29,L,t),data:t});if(s||s===0)r+=s;return r+="\n			",r}function C(e,t){var r="",i;return r+='\n					<a href="',(i=n.photoPageUrl)?i=i.call(e,{hash:{},data:t}):(i=e.photoPageUrl,i=typeof i===a?i.apply(e):i),r+=f(i)+'" class="title">'+f((i=(i=e.photo,i==null||i===!1?i:i.title),typeof i===a?i.apply(e):i))+"</a>\n				",r}function k(e,t){return'\n					<span class="title empty"> </span>\n				'}function L(e,t){var r="",i,s,o;r+='\n					<a href="'+f((i=(i=(i=e.photo,i==null||i===!1?i:i.owner),i==null||i===!1?i:i.url),typeof i===a?i.apply(e):i))+'" class="attribution">\n						',o={hash:{},inverse:c.noop,fn:c.program(30,A,t),data:t},s=(i=n.photoAttribution||e.photoAttribution,i?i.call(e,e.photo,e.flippers,o):l.call(e,"photoAttribution",e.photo,e.flippers,o));if(s||s===0)r+=s;return r+="\n					</a>\n				",r}function A(e,t){var r="",i;r+="\n							",i=n["if"].call(e,e.intlName,{hash:{},inverse:c.program(33,M,t),fn:c.program(31,O,t),data:t});if(i||i===0)r+=i;return r+="\n						",r}function O(e,t){var r="",i,s;return r+="\n								",s={hash:{intlName:e.intlName,user:e.user},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):l.call(e,"intlMessage",s)))+"\n							",r}function M(e,t){var r="",i;return r+="\n								",(i=n.user)?i=i.call(e,{hash:{},data:t}):(i=e.user,i=typeof i===a?i.apply(e):i),r+=f(i)+"\n							",r}function _(e,t){return'\n					<span class="attribution empty"> </span>\n				'}function D(e,t){return'\n				<span class="title empty"> </span>\n				<span class="attribution empty"> </span>\n			'}function P(e,t){return" faved"}function H(e,t){return" fave"}function B(e,t){return" can-not-fave"}function j(e,t){var r="",i;return r+='<span class="icon-count">',(i=n.faveCount)?i=i.call(e,{hash:{},data:t}):(i=e.faveCount,i=typeof i===a?i.apply(e):i),r+=f(i)+"</span>",r}function F(e,t){var r="",i;return r+='<span class="icon-count">',(i=n.commentCount)?i=i.call(e,{hash:{},data:t}):(i=e.commentCount,i=typeof i===a?i.apply(e):i),r+=f(i)+"</span>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers)
,i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='\n<div class="photo-list-photo-interaction">\n	<a class="overlay" href="',(o=n.photoPageUrl)?o=o.call(t,{hash:{},data:i}):(o=t.photoPageUrl,o=typeof o===a?o.apply(t):o),s+=f(o)+'"></a>\n	',o=n["if"].call(t,t.hasExtraFunctionality,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.curatorTools,{hash:{},inverse:c.noop,fn:c.program(8,m,i),data:i});if(o||o===0)s+=o;s+="\n	",u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.isMarketplaceLicensable),{hash:{},inverse:c.noop,fn:c.program(11,y,i),data:i});if(u||u===0)s+=u;s+='\n	<div class="interaction-bar" title="',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.title),{hash:{},inverse:c.program(18,S,i),fn:c.program(16,E,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.isOwner),{hash:{},inverse:c.program(22,T,i),fn:c.program(20,x,i),data:i});if(u||u===0)s+=u;s+='">\n		<div class="text">\n			',u=n["if"].call(t,t.displayTitleAndAttribution,{hash:{},inverse:c.program(37,D,i),fn:c.program(24,N,i),data:i});if(u||u===0)s+=u;s+='\n		</div>\n\n		<div class="tool">\n			<a href="',(u=n.photoPageUrl)?u=u.call(t,{hash:{},data:i}):(u=t.photoPageUrl,u=typeof u===a?u.apply(t):u),s+=f(u)+'" class="fave-area">\n				<i class="fave-star',u=n["if"].call(t,t.isFaved,{hash:{},inverse:c.program(41,H,i),fn:c.program(39,P,i),data:i});if(u||u===0)s+=u;u=n.unless.call(t,t.canFave,{hash:{},inverse:c.noop,fn:c.program(43,B,i),data:i});if(u||u===0)s+=u;s+='"></i>',u=n["if"].call(t,t.faveCount,{hash:{},inverse:c.noop,fn:c.program(45,j,i),data:i});if(u||u===0)s+=u;s+='\n			</a>\n		</div>\n\n		<div class="tool">\n			<a href="',(u=n.photoPageUrl)?u=u.call(t,{hash:{},data:i}):(u=t.photoPageUrl,u=typeof u===a?u.apply(t):u),s+=f(u)+'" class="comment-area">\n				<i class="comments"></i>',u=n["if"].call(t,t.commentCount,{hash:{},inverse:c.noop,fn:c.program(47,F,i),data:i});if(u||u===0)s+=u;return s+="\n			</a>\n		</div>\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-list-photo-interaction",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-list-photo-interaction-view",function(e,t){var n=require("lib/helpers/type-validator"),r=require("lib/flog")(t);"use strict";var i=300,s={css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",scotchTool:"scotch-photo",licenseButton:".photoListLicenseButton"}},o=25,u=20,a=10,f=75;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),(!t.signedIn||e.nsid!==t.nsid)&&this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this},loadState:function(){var t=[],n=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),n&&t.push(this.appContext.getModel(n.registryName,n.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],n=e[1];this.set("engagement",t),this.extraFunctionality={},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=s.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=s.css.removePoolTool:n&&(n.getValue("group").getValue("isAdmin")||n.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=s.css.removePoolTool):this.params.scotch&&(this.extraFunctionality.removeToolClass=s.css.scotchTool),this.params.excludePeople&&(this.extraFunctionality.moreMenuItems="exclude-people"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"}))}.bind(this))},buildContainer:function(e){var t=this.get("engagement"),n=t.getValue("faveCount"),r=t.getValue("isFaved"),i=t.getValue("canFave"),s=t.getValue("commentCount"),l=55,c=!0;return n>=100?l+=o:n>=10?l+=u:n>0&&(l+=a),s>=100?l+=o:s>=10?l+=u:s>0&&(l+=a),this.get("layoutWidth")-l<f&&(c=!1),e=e||{},n=n<100?n:"99+",s=s<100?s:"99+",e.photo=this.get("model").toJSON(),e.photoPageUrl=this.get("photoPageUrl"),e.faveCount=n,e.isFaved=r,e.canFave=i,e.commentCount=s,e.displayTitleAndAttribution=c,e.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,e.removeToolClass=this.extraFunctionality.removeToolClass,e.moreMenuItems=this.extraFunctionality.moreMenuItems,e.bigScotchTitle=this.extraFunctionality.bigScotchTitle,e.curatorTools=this.getCuratorTools(),this.setContainerHTML(this.templates("photo-list-photo-interaction")(e)),this},activate:function(){var e=this.appContext.getViewer(),t=this.get("engagement"),n=this.get("container");return this.get("engagement").getValue("canFave")&&(this.registerEventHandler(t.on("valuesChanged",this.faveStarChanged.bind(this))),this.registerEventHandler(n.delegate("click",this.faveStarClicked.bind(this),s.css.faveClickArea))),this.signedOutTest&&!e|!e.signedIn&&this.registerEventHandler(n.delegate("click",this.commentClicked.bind(this),s.css.commentClickArea)),this.appContext.flipper.isFlipped("display-marketplace-licensable")&&n.one(s.css.licenseButton)&&(this.registerEventHandler(n.one(s.css.licenseButton).on("click",this.licenseButtonClick,this)),this.registerEventHandler(n.one(s.css.licenseButton).on("mouseenter",this.licenseButtonHover,this)),this.registerEventHandler(n.one(s.css.licenseButton).on("mouseleave",this.licenseButtonHover,this))),this},licenseButtonHover:function(t){t.halt();var n=t.type,r=this;if(n==="mouseenter"){if(e.StorageHelper.getItem("seenThirdParty"))return;this.tooltip&&this.tooltip.close(),clearTimeout(this.tooltipHoverTimer),this.isHovering=!0,this.tooltipHoverTimer=setTimeout(function(){r.isHovering&&(r.tooltip=new e.Views.FluidDroparound({appContext:r.appContext,showDropArrow:!0,dismissOnOverlayClick:!1,dismissOnActionClick:!1,observePageResize:!0,anchorElement:t.target,positionFixed:!0,closeOnScroll:!0,hideModalOverlay:!0,invisibleOverlay:!0,autoSizeToContent:!0,useAnchorOffsetSize:!0,horizCenterToAnchor:!0,preferTop:!0,classList:"photo-license-pop-up",textMessage:r.intlMessage({intlName:"common.CLICK_BUTTON_THIRD_PARTY"})}),r.tooltip.show())},i)}else this.isHovering=!1,this.tooltip&&this.tooltip.close()},licenseButtonClick:function(t){var n={owner_id:t.target.getData("ownerid"),photo_id:t.target.getData("photoid")};this.appContext.callAPI("flickr.licensing.marketplace.addClick",n).then(function(){e.StorageHelper.setItem("seenThirdParty",1)},function(e){r.error("flickr.licensing.marketplace.addClick failed",{err:e,photoId:n.photo_id})})},commentClicked:function(t){var n=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),i,s=this.get("engagement"),o,u=this;t.halt(),e.rapidTracker.beacon(u.name,"commentIconClick"),o=e.url(e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("ownerNsid")})),i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:n,signUpMessage:r,beaconPrefix:"comment"}),i.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:o})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:o})}),i.show()},getCuratorTools:function(){if(!this.appContext.flipper.isFlipped("enable-curator-tools")||!this.appContext.getViewer().isInsecureGod)return null;var e=this.get("model"),t=e&&e.getValue("curation"),n=[];return t?(["is3MP","ownerCountryApproved","ownerFollowedByCurators","ownerAdded","ownerPassedOver"].forEach(function(e){t.getValue(e)&&n.push({name:e})}),n):null},showSignUpAndFaveModal:function(t,n){var r=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),i=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}
),s;s=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:r,signUpMessage:i,beaconPrefix:"fave"}),s.on("signUpClick",function(r){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:n})}),s.on("signInClick",function(r){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:n})}),s.show()},faveStarClicked:function(t){var n=this.appContext.getViewer(),r=this.get("engagement"),i=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),s=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),o=this.intlMessage({intlName:"common.CANCEL"}),u,a,f,l=this;t.halt(),e.rapidTracker.beacon(this.name,"faveButtonClick");if(n&&n.signedIn)this.get("isFaving")||(this.set("isFaving",!0),r.toggleFave(),r.remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(n.nsid).getValue("photoPageList").remove(l.get("model"))}),this.set("isFaving",!1)}.bind(this),function(e){e.code!==3&&r.toggleFave(),this.set("isFaving",!1)}.bind(this)));else{a=r.getValue("id"),f=e.url(e.URLHelper.getPhotoPage({photoId:a,pathAlias:r.getValue("ownerNsid")}));if(this.signedOutTest)return this.showSignUpAndFaveModal(a,f);u=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:i,actionButtonLabel:s,cancelButtonLabel:o}),u.on("actionClick",function(){e.rapidTracker.beacon(l.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:a},{postLoginUrl:f})}),u.on("cancelClick",function(t){e.rapidTracker.beacon(l.name,"faveModalCancelClick")}),u.show()}t.halt()},faveStarChanged:function(e){(e.faveCount!==undefined||e.isFaved!==undefined||e.canFave!==undefined)&&this.buildContainer()},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return n.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,n){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,n){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||undefined},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,n){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","photo-list-photo-interaction-css","attribute-helpers","fluid-modal-view","fluid-droparound-view","url","flickrui-css"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});
YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});
